{"data":{"configlet":[{"key":"configlet_a60bde3e-7cd2-4f9a-8264-37aca799448d","name":"underlay_YAML","reconciled":false,"config":"global:\r\n  DC1:\r\n    spine_ASN: 65100\r\n    p2p: \"192.168.103.0\/24\"\r\n    lo0: \"192.168.101.0\/24\"\r\n    spine_peers:\r\n      - 192.168.101.101\r\n      - 192.168.101.102\r\n      - 192.168.101.103\r\n  DC2:\r\n    spine_ASN: 65200\r\n    p2p: \"192.168.203.0\/24\"\r\n    lo0: \"192.168.201.0\/24\"\r\n    spine_peers:\r\n      - 192.168.201.101\r\n      - 192.168.201.102\r\n      - 192.168.201.103\r\n  MTU: 9214\r\nspine1-DC1:\r\n  interfaces:\r\n    loopback0: \r\n      ipv4: 192.168.101.101\r\n      mask: 32\r\n    Ethernet2: \r\n      ipv4: 192.168.103.1\r\n      mask: 31\r\n    Ethernet3: \r\n      ipv4: 192.168.103.7\r\n      mask: 31\r\n    Ethernet4: \r\n      ipv4: 192.168.103.13\r\n      mask: 31\r\n    Ethernet5: \r\n      ipv4: 192.168.103.19\r\n      mask: 31\r\n    Ethernet6: \r\n      ipv4: 192.168.103.25\r\n      mask: 31\r\n    Ethernet7: \r\n      ipv4: 192.168.103.31\r\n      mask: 31\r\n  BGP:\r\n    ASN: 65100\r\nspine2-DC1:\r\n  interfaces:\r\n    loopback0: \r\n      ipv4: 192.168.101.102\r\n      mask: 32\r\n    Ethernet2: \r\n      ipv4: 192.168.103.3\r\n      mask: 31\r\n    Ethernet3: \r\n      ipv4: 192.168.103.9\r\n      mask: 31\r\n    Ethernet4: \r\n      ipv4: 192.168.103.15\r\n      mask: 31\r\n    Ethernet5: \r\n      ipv4: 192.168.103.21\r\n      mask: 31\r\n    Ethernet6: \r\n      ipv4: 192.168.103.27\r\n      mask: 31\r\n    Ethernet7: \r\n      ipv4: 192.168.103.33\r\n      mask: 31\r\n  BGP:\r\n    ASN: 65100\r\nspine3-DC1:\r\n  interfaces:\r\n    loopback0: \r\n      ipv4: 192.168.101.103\r\n      mask: 32\r\n    Ethernet2: \r\n      ipv4: 192.168.103.5\r\n      mask: 31\r\n    Ethernet3: \r\n      ipv4: 192.168.103.11\r\n      mask: 31\r\n    Ethernet4: \r\n      ipv4: 192.168.103.17\r\n      mask: 31\r\n    Ethernet5: \r\n      ipv4: 192.168.103.23\r\n      mask: 31\r\n    Ethernet6: \r\n      ipv4: 192.168.103.29\r\n      mask: 31\r\n    Ethernet7: \r\n      ipv4: 192.168.103.35\r\n      mask: 31\r\n  BGP:\r\n    ASN: 65100\r\nleaf1-DC1:\r\n  interfaces:\r\n    loopback0: \r\n      ipv4: 192.168.101.11\r\n      mask: 32\r\n    loopback1: \r\n      ipv4: 192.168.102.11\r\n      mask: 32\r\n    Ethernet3:\r\n      ipv4: 192.168.103.0\r\n      mask: 31\r\n    Ethernet4: \r\n      ipv4: 192.168.103.2\r\n      mask: 31\r\n    Ethernet5: \r\n      ipv4: 192.168.103.4\r\n      mask: 31\r\n  BGP: \r\n    ASN: 65101\r\n    spine-peers:\r\n      - 192.168.103.1\r\n      - 192.168.103.3\r\n      - 192.168.103.5\r\n    spine-ASN: 65100\r\n  MLAG: Odd\r\nleaf2-DC1:\r\n  interfaces:\r\n    loopback0: \r\n      ipv4: 192.168.101.12\r\n      mask: 32\r\n    loopback1: \r\n      ipv4: 192.168.102.11\r\n      mask: 32\r\n    Ethernet3:\r\n      ipv4: 192.168.103.6\r\n      mask: 31\r\n    Ethernet4: \r\n      ipv4: 192.168.103.8\r\n      mask: 31\r\n    Ethernet5: \r\n      ipv4: 192.168.103.10\r\n      mask: 31\r\n  BGP: \r\n    ASN: 65101\r\n    spine-peers:\r\n      - 192.168.103.7\r\n      - 192.168.103.9\r\n      - 192.168.103.11\r\n    spine-ASN: 65100\r\n  MLAG: Even\r\nleaf3-DC1:\r\n  interfaces:\r\n    loopback0: \r\n      ipv4: 192.168.101.13\r\n      mask: 32\r\n    loopback1: \r\n      ipv4: 192.168.102.13\r\n      mask: 32\r\n    Ethernet3: \r\n      ipv4: 192.168.103.12\r\n      mask: 31\r\n    Ethernet4:\r\n      ipv4: 192.168.103.14\r\n      mask: 31\r\n    Ethernet5: \r\n      ipv4: 192.168.103.16\r\n      mask: 31\r\n  BGP:\r\n    ASN: 65102\r\n    spine-peers:\r\n      - 192.168.103.13\r\n      - 192.168.103.15\r\n      - 192.168.103.17\r\n    spine-ASN: 65100\r\n  MLAG: Even\r\nleaf4-DC1:\r\n  interfaces:\r\n    loopback0: \r\n      ipv4: 192.168.101.14\r\n      mask: 32\r\n    loopback1: \r\n      ipv4: 192.168.102.13\r\n      mask: 32\r\n    Ethernet3: \r\n      ipv4: 192.168.103.18\r\n      mask: 31\r\n    Ethernet4: \r\n      ipv4: 192.168.103.20\r\n      mask: 31\r\n    Ethernet5: \r\n      ipv4: 192.168.103.22\r\n      mask: 31\r\n  BGP:\r\n    ASN: 65102\r\n    spine-peers:\r\n      - 192.168.103.19\r\n      - 192.168.103.21\r\n      - 192.168.103.23\r\n    spine-ASN: 65100\r\n  MLAG: Odd\r\nborderleaf1-DC1:\r\n  interfaces:\r\n    loopback0: \r\n      ipv4: 192.168.101.21\r\n      mask: 32\r\n    loopback1: \r\n      ipv4: 192.168.102.21\r\n      mask: 32\r\n    Ethernet3: \r\n      ipv4: 192.168.103.24\r\n      mask: 31\r\n    Ethernet4: \r\n      ipv4: 192.168.103.26\r\n      mask: 31\r\n    Ethernet5: \r\n      ipv4: 192.168.103.28\r\n      mask: 31\r\n    Ethernet12:\r\n      ipv4: 192.168.254.0\r\n      mask: 31\r\n  BGP:\r\n    ASN: 65103\r\n    spine-peers:\r\n      - 192.168.103.25\r\n      - 192.168.103.27\r\n      - 192.168.103.29\r\n    spine-ASN: 65100\r\n    DCI-peers:\r\n      - 192.168.254.1\r\n  MLAG: Odd\r\n\r\nborderleaf2-DC1:\r\n  interfaces:\r\n    loopback0: \r\n      ipv4: 192.168.101.21\r\n      mask: 32\r\n    loopback1: \r\n      ipv4: 192.168.102.21\r\n      mask: 32\r\n    Ethernet3: \r\n      ipv4: 192.168.103.30\r\n      mask: 31\r\n    Ethernet4: \r\n      ipv4: 192.168.103.32\r\n      mask: 31\r\n    Ethernet5: \r\n      ipv4: 192.168.103.34\r\n      mask: 31\r\n    Ethernet12:\r\n      ipv4: 192.168.254.2\r\n      mask: 31\r\n  BGP:\r\n    ASN: 65103\r\n    spine-peers:\r\n      - 192.168.103.31\r\n      - 192.168.103.33\r\n      - 192.168.103.35\r\n    spine-ASN: 65100\r\n    DCI-peers:\r\n      - 192.168.254.3\r\n  MLAG: Even\r\n\r\nspine1-DC2:\r\n  interfaces:\r\n    loopback0: \r\n      ipv4: 192.168.201.101\r\n      mask: 32\r\n    Ethernet2: \r\n      ipv4: 192.168.203.1\r\n      mask: 31\r\n    Ethernet3: \r\n      ipv4: 192.168.203.7\r\n      mask: 31\r\n    Ethernet4: \r\n      ipv4: 192.168.203.13\r\n      mask: 31\r\n    Ethernet5: \r\n      ipv4: 192.168.203.19\r\n      mask: 31\r\n    Ethernet6: \r\n      ipv4: 192.168.203.25\r\n      mask: 31\r\n    Ethernet7: \r\n      ipv4: 192.168.203.31\r\n      mask: 31\r\n  BGP:\r\n    ASN: 65200\r\nspine2-DC2:\r\n  interfaces:\r\n    loopback0: \r\n      ipv4: 192.168.201.102\r\n      mask: 32\r\n    Ethernet2: \r\n      ipv4: 192.168.203.3\r\n      mask: 31\r\n    Ethernet3: \r\n      ipv4: 192.168.203.9\r\n      mask: 31\r\n    Ethernet4: \r\n      ipv4: 192.168.203.15\r\n      mask: 31\r\n    Ethernet5: \r\n      ipv4: 192.168.203.21\r\n      mask: 31\r\n    Ethernet6: \r\n      ipv4: 192.168.203.27\r\n      mask: 31\r\n    Ethernet7: \r\n      ipv4: 192.168.203.33\r\n      mask: 31\r\n  BGP:\r\n    ASN: 65200\r\nspine3-DC2:\r\n  interfaces:\r\n    loopback0: \r\n      ipv4: 192.168.201.103\r\n      mask: 32\r\n    Ethernet2: \r\n      ipv4: 192.168.203.5\r\n      mask: 31\r\n    Ethernet3: \r\n      ipv4: 192.168.203.11\r\n      mask: 31\r\n    Ethernet4: \r\n      ipv4: 192.168.203.17\r\n      mask: 31\r\n    Ethernet5: \r\n      ipv4: 192.168.203.23\r\n      mask: 31\r\n    Ethernet6: \r\n      ipv4: 192.168.203.29\r\n      mask: 31\r\n    Ethernet7: \r\n      ipv4: 192.168.203.35\r\n      mask: 31\r\n  BGP:\r\n    ASN: 65200\r\nleaf1-DC2:\r\n  interfaces:\r\n    loopback0: \r\n      ipv4: 192.168.201.11\r\n      mask: 32\r\n    loopback1: \r\n      ipv4: 192.168.202.11\r\n      mask: 32\r\n    Ethernet3:\r\n      ipv4: 192.168.203.0\r\n      mask: 31\r\n    Ethernet4: \r\n      ipv4: 192.168.203.2\r\n      mask: 31\r\n    Ethernet5: \r\n      ipv4: 192.168.203.4\r\n      mask: 31\r\n  BGP: \r\n    ASN: 65201\r\n    spine-peers:\r\n      - 192.168.203.1\r\n      - 192.168.203.3\r\n      - 192.168.203.5\r\n    spine-ASN: 65200\r\n  MLAG: Odd\r\nleaf2-DC2:\r\n  interfaces:\r\n    loopback0: \r\n      ipv4: 192.168.201.12\r\n      mask: 32\r\n    loopback1: \r\n      ipv4: 192.168.202.11\r\n      mask: 32\r\n    Ethernet3:\r\n      ipv4: 192.168.203.6\r\n      mask: 31\r\n    Ethernet4: \r\n      ipv4: 192.168.203.8\r\n      mask: 31\r\n    Ethernet5: \r\n      ipv4: 192.168.203.10\r\n      mask: 31\r\n  BGP: \r\n    ASN: 65201\r\n    spine-peers:\r\n      - 192.168.203.7\r\n      - 192.168.203.9\r\n      - 192.168.203.11\r\n    spine-ASN: 65200\r\n  MLAG: Even\r\nleaf3-DC2:\r\n  interfaces:\r\n    loopback0: \r\n      ipv4: 192.168.201.13\r\n      mask: 32\r\n    loopback1: \r\n      ipv4: 192.168.202.13\r\n      mask: 32\r\n    Ethernet3: \r\n      ipv4: 192.168.203.12\r\n      mask: 31\r\n    Ethernet4:\r\n      ipv4: 192.168.203.14\r\n      mask: 31\r\n    Ethernet5: \r\n      ipv4: 192.168.203.16\r\n      mask: 31\r\n  BGP:\r\n    ASN: 65202\r\n    spine-peers:\r\n      - 192.168.203.13\r\n      - 192.168.203.15\r\n      - 192.168.203.17\r\n    spine-ASN: 65200\r\n  MLAG: Odd\r\nleaf4-DC2:\r\n  interfaces:\r\n    loopback0: \r\n      ipv4: 192.168.201.14\r\n      mask: 32\r\n    loopback1: \r\n      ipv4: 192.168.202.13\r\n      mask: 32\r\n    Ethernet3: \r\n      ipv4: 192.168.203.18\r\n      mask: 31\r\n    Ethernet4: \r\n      ipv4: 192.168.203.20\r\n      mask: 31\r\n    Ethernet5: \r\n      ipv4: 192.168.203.22\r\n      mask: 31\r\n  BGP:\r\n    ASN: 65202\r\n    spine-peers:\r\n      - 192.168.203.19\r\n      - 192.168.203.21\r\n      - 192.168.203.23\r\n    spine-ASN: 65200\r\n  MLAG: Even\r\nborderleaf1-DC2:\r\n  interfaces:\r\n    loopback0: \r\n      ipv4: 192.168.201.21\r\n      mask: 32\r\n    loopback1: \r\n      ipv4: 192.168.202.21\r\n      mask: 32\r\n    Ethernet3: \r\n      ipv4: 192.168.203.24\r\n      mask: 31\r\n    Ethernet4: \r\n      ipv4: 192.168.203.26\r\n      mask: 31\r\n    Ethernet5: \r\n      ipv4: 192.168.203.28\r\n      mask: 31\r\n    Ethernet12:\r\n      ipv4: 192.168.254.4\r\n      mask: 31\r\n  BGP:\r\n    ASN: 65203\r\n    spine-peers:\r\n      - 192.168.203.25\r\n      - 192.168.203.27\r\n      - 192.168.203.29\r\n    spine-ASN: 65200\r\n    DCI-peers:\r\n      - 192.168.254.5\r\n  MLAG: Odd\r\nborderleaf2-DC2:\r\n  interfaces:\r\n    loopback0: \r\n      ipv4: 192.168.201.21\r\n      mask: 32\r\n    loopback1: \r\n      ipv4: 192.168.202.21\r\n      mask: 32\r\n    Ethernet3: \r\n      ipv4: 192.168.203.30\r\n      mask: 31\r\n    Ethernet4: \r\n      ipv4: 192.168.203.32\r\n      mask: 31\r\n    Ethernet5: \r\n      ipv4: 192.168.203.34\r\n      mask: 31\r\n    Ethernet12:\r\n      ipv4: 192.168.254.6\r\n      mask: 31\r\n  BGP:\r\n    ASN: 65203\r\n    spine-peers:\r\n      - 192.168.203.31\r\n      - 192.168.203.33\r\n      - 192.168.203.35\r\n    spine-ASN: 65200\r\n    DCI-peers:\r\n    - 192.168.254.7\r\n  MLAG: Even\r\n","user":"arista","note":"","containerCount":0,"netElementCount":0,"dateTimeInLongFormat":1658262071041,"isDefault":"no","isAutoBuilder":"","type":"Static","editable":true,"sslConfig":false,"visible":true,"isDraft":false}],"configletBuilder":[{"isAssigned":false,"sslConfig":false,"editable":true,"name":"EVPN_underlay_with_Vars_cfglet","formList":[],"type":"BUILDER_WITHOUT_DRAFT","main_script":{"data":"from cvplibrary import CVPGlobalVariables, GlobalVariableNames\r\nimport yaml \r\nfrom cvplibrary import RestClient\r\nimport ssl\r\n\r\n\r\nstuff = CVPGlobalVariables.getValue(GlobalVariableNames.CVP_SYSTEM_LABELS)\r\n\r\n#print(stuff)\r\n\r\nfor item in stuff: \r\n  key, value = item.split(':')\r\n  if key == 'hostname':\r\n    hostname = value\r\n    #print(hostname)\r\n\r\nssl._create_default_https_context = ssl._create_unverified_context\r\n\r\nconfiglet = 'underlay_YAML'\r\n\r\ncvp_url = 'https:\/\/192.168.0.5\/cvpservice\/'\r\n\r\nclient= RestClient(cvp_url+'configlet\/getConfigletByName.do?name='+configlet,'GET')\r\n\r\nif client.connect():\r\n    raw = yaml.load(client.getResponse())\r\n\r\nunderlay = yaml.safe_load(raw['config'])\r\n\r\n\r\n\r\ndef gen_interfaces(hostname):\r\n  for interface in underlay[hostname]['interfaces']:\r\n    ip = underlay[hostname]['interfaces'][interface]['ipv4']\r\n    mask = underlay[hostname]['interfaces'][interface]['mask']\r\n    print(\"interface %s\") % interface\r\n    print(\"   ip address %s\/%s\") % (ip, mask)\r\n    if 'thernet' in interface:\r\n      print(\"   no switchport\")\r\n\r\n\r\n\r\n\r\nprint(\"service routing protocols model multi-agent\")\r\n\r\nloopback = \"\"\"\r\nip prefix-list LOOPBACK\r\n    seq 10 permit 192.168.101.0\/24 eq 32\r\n    seq 11 permit 192.168.102.0\/24 eq 32\r\n    seq 12 permit 192.168.201.0\/24 eq 32\r\n    seq 13 permit 192.168.202.0\/24 eq 32\r\n    seq 14 permit 192.168.253.0\/24 eq 32\r\n\r\n\r\nroute-map LOOPBACK permit 10\r\n  match ip address prefix-list LOOPBACK\r\n\"\"\"\r\n\r\npeer_range = \"\"\"\r\npeer-filter LEAF-AS-RANGE\r\n10 match as-range 65000-65535 result accept\r\n\"\"\"\r\n\r\ndef gen_spine_bgp():\r\n  print(loopback)\r\n  print(peer_range)\r\n  ASN = underlay[hostname]['BGP']['ASN']\r\n  loopback0 = underlay[hostname]['interfaces']['loopback0']['ipv4']\r\n  print(\"router bgp %s\") % ASN  \r\n  \r\n  print(\"  router-id %s \") % loopback0\r\n  print(\"  no bgp default ipv4-unicast\")\r\n  print(\"  maximum-paths 3\")\r\n  print(\"  distance bgp 20 200 200\")\r\n\r\n  if 'DC1' in hostname:\r\n    range = \"192.168.103.0\/24\"\r\n  if 'DC2' in hostname:\r\n    range = \"192.168.203.0\/24\"\r\n    \r\n  print(\"  bgp listen range %s peer-group LEAF_Underlay peer-filter LEAF-AS-RANGE\") % range\r\n      \r\n  print(\" neighbor LEAF_Underlay peer group\")\r\n  print(\" neighbor LEAF_Underlay send-community\")\r\n  print(\" neighbor LEAF_Underlay maximum-routes 12000\") \r\n\r\n  \r\n\r\n  print(\"  neighbor EVPN peer group\") \r\n\r\n  if 'DC1' in hostname:\r\n    evpn_range = \"192.168.101.0\/24\"\r\n  if 'DC2' in hostname:\r\n    evpn_range = \"192.168.201.0\/24\"\r\n  print(\"  bgp listen range %s peer-group EVPN peer-filter LEAF-AS-RANGE\") % evpn_range\r\n      \r\n  \r\n  print(\"  neighbor EVPN update-source Loopback0\")\r\n  print(\"  neighbor EVPN ebgp-multihop 3\")\r\n  print(\"  neighbor EVPN send-community extended\")\r\n  print(\"  neighbor EVPN maximum-routes 0\")\r\n\r\n  print(\"  address-family evpn\")\r\n  print(\"    neighbor EVPN activate\")\r\n  print(\"  address-family ipv4\")\r\n  print(\"    neighbor LEAF_Underlay activate\")\r\n  print(\"    redistribute connected route-map LOOPBACK\")\r\n  \r\n\r\ndef gen_leaf_bgp():\r\n  print(loopback)\r\n  print(peer_range)\r\n  ASN = underlay[hostname]['BGP']['ASN']\r\n  loopback0 = underlay[hostname]['interfaces']['loopback0']['ipv4']\r\n  print(\"router bgp %s\") % ASN  \r\n  \r\n  print(\"  router-id %s \") % loopback0\r\n  print(\"  no bgp default ipv4-unicast\")\r\n  print(\"  maximum-paths 3\")\r\n  print(\"  distance bgp 20 200 200\")\r\n\r\n  if 'DC1' in hostname:\r\n    spine_ASN = underlay['global']['DC1']['spine_ASN']\r\n  if 'DC2' in hostname:\r\n    spine_ASN = underlay['global']['DC2']['spine_ASN']\r\n    \r\n  if 'DC1' in hostname:\r\n    evpn_range = \"192.168.101.0\/24\"\r\n  if 'DC2' in hostname:\r\n    evpn_range = \"192.168.201.0\/24\"\r\n  print(\"  bgp listen range %s peer-group EVPN peer-filter LEAF-AS-RANGE\") % evpn_range\r\n\r\n\r\n  print(\"  neighbor SPINE_Underlay peer group\")\r\n  print(\"  neighbor SPINE_Underlay remote-as %s\") % spine_ASN\r\n  print(\"  neighbor SPINE_Underlay send-community\")\r\n  print(\"  neighbor SPINE_Underlay maximum-routes 12000\") \r\n\r\n\r\n  print(\"  neighbor LEAF_Peer peer group\")\r\n  print(\"  neighbor LEAF_Peer remote-as %s\") % ASN\r\n  print(\"  neighbor LEAF_Peer next-hop-self\")\r\n  print(\"  neighbor LEAF_Peer maximum-routes 12000\")\r\n\r\n  for neighbor in underlay[hostname]['BGP']['spine-peers']:\r\n    print(\"  neighbor %s peer group SPINE_Underlay\") % neighbor\r\n  \r\n  print(\"  address-family ipv4\")\r\n  print(\"  neighbor SPINE_Underlay activate\")\r\n  print(\"     redistribute connected route-map LOOPBACK\")\r\n  \r\n\r\nif ('leaf' in hostname) or ('spine' in hostname):\r\n  gen_interfaces(hostname)\r\n\r\nif 'spine' in hostname:\r\n  gen_spine_bgp()\r\nif 'leaf' in hostname:\r\n  gen_leaf_bgp()\r\n","key":null}}]}}